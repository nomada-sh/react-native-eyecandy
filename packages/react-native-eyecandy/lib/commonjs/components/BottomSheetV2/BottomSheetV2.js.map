{"version":3,"sources":["BottomSheetV2.tsx"],"names":["HANDLE_HEIGHT","Content","children","height","initialHeight","visible","onDismiss","onClose","onOpen","open","background","divider","c","default","y","value","doOpenAnimation","damping","doCloseAnimation","duration","gestureHandler","onStart","_","ctx","startY","onActive","event","translationY","onEnd","animatedStyle","transform","translateY","backgroundColor","content","borderTopLeftRadius","borderTopRightRadius","overflow","width","alignItems","justifyContent","styles","handle","flex","WrappedContent","BottomSheet","modalVisible","setModalVisible","handleClose","container","mask","StyleSheet","create","borderRadius"],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo, useState } from 'react';\nimport {\n  Modal,\n  StyleSheet,\n  View,\n  TouchableWithoutFeedback,\n} from 'react-native';\n\nimport Animated, {\n  useSharedValue,\n  withSpring,\n  useAnimatedStyle,\n  useAnimatedGestureHandler,\n  withTiming,\n  runOnJS,\n  useCode,\n  call,\n} from 'react-native-reanimated';\n\nimport {\n  gestureHandlerRootHOC,\n  PanGestureHandler,\n  PanGestureHandlerGestureEvent,\n} from 'react-native-gesture-handler';\n\nimport { useUpdateEffect } from 'react-use';\n\nimport { useColors } from '@nomada-sh/react-native-eyecandy-theme';\n\nconst HANDLE_HEIGHT = 40;\n\ntype Context = {\n  startY: number;\n};\n\nexport interface ContentProps {\n  children?: React.ReactNode;\n  height: number;\n  visible?: boolean;\n  onDismiss?: () => void;\n  onClose?: () => void;\n  onOpen?: () => void;\n}\n\nfunction Content({\n  children,\n  height: initialHeight,\n  visible,\n  onDismiss,\n  onClose,\n  onOpen,\n}: ContentProps) {\n  const height = useSharedValue(initialHeight);\n  const open = useSharedValue(false);\n\n  const { background, divider } = useColors(c => ({\n    background: c.background.default,\n    divider: c.divider.default,\n  }));\n  const y = useSharedValue(height.value);\n\n  const doOpenAnimation = useCallback(() => {\n    'worklet';\n\n    open.value = true;\n\n    y.value = withSpring(0, { damping: 12 }, () => {\n      onOpen && runOnJS(onOpen)();\n    });\n  }, [onOpen, open, y]);\n\n  const doCloseAnimation = useCallback(() => {\n    'worklet';\n\n    open.value = false;\n\n    y.value = withTiming(height.value, { duration: 300 }, () => {\n      onClose && runOnJS(onClose)();\n    });\n  }, [height, onClose, open, y]);\n\n  const gestureHandler = useAnimatedGestureHandler<\n    PanGestureHandlerGestureEvent,\n    Context\n  >({\n    onStart: (_, ctx) => {\n      ctx.startY = y.value;\n    },\n    onActive: (event, ctx) => {\n      y.value = ctx.startY + event.translationY;\n    },\n    onEnd: event => {\n      if (height.value / 3 - event.translationY < 0) {\n        onDismiss && runOnJS(onDismiss)();\n      }\n\n      y.value = withSpring(0);\n    },\n  });\n\n  const animatedStyle = useAnimatedStyle(() => {\n    return {\n      transform: [{ translateY: y.value }],\n      height: height.value * 2,\n      backgroundColor: background.content,\n      borderTopLeftRadius: 32,\n      borderTopRightRadius: 32,\n      overflow: 'hidden',\n    };\n  });\n\n  useCode(\n    () =>\n      call([], () => {\n        if (visible && !open.value) {\n          doOpenAnimation();\n        } else if (!visible && open.value) {\n          doCloseAnimation();\n        }\n      }),\n    [visible, open],\n  );\n\n  return (\n    <PanGestureHandler onGestureEvent={gestureHandler}>\n      <Animated.View style={animatedStyle}>\n        <View\n          style={{\n            height: HANDLE_HEIGHT,\n            width: '100%',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <View\n            style={[\n              styles.handle,\n              {\n                backgroundColor: divider,\n              },\n            ]}\n          />\n        </View>\n        <View\n          style={{\n            flex: 1,\n          }}\n        >\n          {children}\n        </View>\n        <View\n          style={{\n            width: '100%',\n            height: height.value,\n          }}\n        />\n      </Animated.View>\n    </PanGestureHandler>\n  );\n}\n\nconst WrappedContent = gestureHandlerRootHOC(Content);\n\nexport interface BottomSheetProps {\n  children?: React.ReactNode;\n  visible?: boolean;\n  height: number;\n  onClose?: () => void;\n}\n\nfunction BottomSheet({\n  children,\n  visible,\n  height: initialHeight,\n  onClose,\n}: BottomSheetProps) {\n  const height = useMemo(() => initialHeight + HANDLE_HEIGHT, [initialHeight]);\n  const [modalVisible, setModalVisible] = useState<boolean | undefined>(\n    visible,\n  );\n\n  const handleClose = useCallback(() => {\n    setModalVisible(false);\n  }, []);\n\n  useUpdateEffect(() => {\n    if (visible) setModalVisible(visible);\n  }, [visible]);\n\n  return (\n    <Modal\n      animationType=\"fade\"\n      visible={modalVisible}\n      statusBarTranslucent\n      transparent\n      onRequestClose={onClose}\n    >\n      <View\n        style={[\n          styles.container,\n          {\n            backgroundColor: 'rgba(0,0,0,0.5)',\n          },\n        ]}\n      >\n        <TouchableWithoutFeedback onPress={onClose}>\n          <View style={styles.mask} />\n        </TouchableWithoutFeedback>\n        <View\n          style={{\n            height,\n          }}\n        >\n          <WrappedContent\n            height={height}\n            visible={visible}\n            onDismiss={onClose}\n            onClose={handleClose}\n          >\n            {children}\n          </WrappedContent>\n        </View>\n      </View>\n    </Modal>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: 'flex-end',\n  },\n  mask: {\n    flex: 1,\n  },\n  handle: {\n    height: 6,\n    width: 64,\n    borderRadius: 3,\n  },\n});\n\nexport default BottomSheet;\n"]}