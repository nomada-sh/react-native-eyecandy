{"version":3,"sources":["RBSheet.tsx"],"names":["SUPPORTED_ORIENTATIONS","RBSheet","Component","constructor","props","state","modalVisible","animatedHeight","Animated","Value","pan","ValueXY","panResponder","PanResponder","create","createPanResponder","setModalVisible","visible","height","minClosingHeight","openDuration","closeDuration","onClose","onOpen","setState","spring","toValue","useNativeDriver","start","timing","duration","setValue","x","y","closeOnDragDown","onStartShouldSetPanResponder","onPanResponderMove","e","gestureState","dy","event","onPanResponderRelease","_","open","close","render","animationType","dragFromTopOnly","closeOnPressMask","closeOnPressBack","children","customStyles","keyboardAvoidingViewEnabled","panStyle","transform","getTranslateTransform","styles","wrapper","mask","panHandlers","container","draggableContainer","draggableIcon","Platform","OS","StyleSheet","flex","backgroundColor","width","overflow","alignItems","borderRadius","margin"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {\n  View,\n  KeyboardAvoidingView,\n  Modal,\n  TouchableOpacity,\n  Animated,\n  PanResponder,\n  StyleProp,\n  ViewStyle,\n  ModalProps,\n  PanResponderInstance,\n  StyleSheet,\n  Platform,\n} from 'react-native';\n\nconst SUPPORTED_ORIENTATIONS: ModalProps['supportedOrientations'] = [\n  'portrait',\n  'portrait-upside-down',\n  'landscape',\n  'landscape-left',\n  'landscape-right',\n];\n\nexport interface RBSheetProps {\n  animationType: 'none' | 'fade' | 'slide';\n  height: number;\n  minClosingHeight: number;\n  openDuration: number;\n  closeDuration: number;\n  closeOnDragDown: boolean;\n  dragFromTopOnly: boolean;\n  closeOnPressMask: boolean;\n  closeOnPressBack: boolean;\n  keyboardAvoidingViewEnabled: boolean;\n  onClose: () => void;\n  onOpen: () => void;\n  customStyles: {\n    wrapper?: StyleProp<ViewStyle>;\n    container?: StyleProp<ViewStyle>;\n    draggableIcon?: StyleProp<ViewStyle>;\n  };\n  children?: React.ReactNode;\n  grantThreshold?: number;\n}\n\nexport interface RBSheetState {\n  modalVisible: boolean;\n  animatedHeight: Animated.Value;\n  pan: Animated.ValueXY;\n}\n\nclass RBSheet extends Component<RBSheetProps, RBSheetState> {\n  static defaultProps: Omit<RBSheetProps, 'children'> = {\n    animationType: 'none',\n    height: 260,\n    minClosingHeight: 0,\n    openDuration: 300,\n    closeDuration: 200,\n    closeOnDragDown: false,\n    dragFromTopOnly: false,\n    closeOnPressMask: true,\n    closeOnPressBack: true,\n    keyboardAvoidingViewEnabled: Platform.OS === 'ios',\n    customStyles: {},\n    onClose: () => {},\n    onOpen: () => {},\n  };\n\n  panResponder: PanResponderInstance;\n\n  constructor(props: RBSheetProps) {\n    super(props);\n\n    this.state = {\n      modalVisible: false,\n      animatedHeight: new Animated.Value(0),\n      pan: new Animated.ValueXY(),\n    };\n\n    this.panResponder = PanResponder.create({});\n\n    this.createPanResponder(props);\n  }\n\n  setModalVisible(visible: boolean) {\n    const {\n      height,\n      minClosingHeight,\n      openDuration,\n      closeDuration,\n      onClose,\n      onOpen,\n    } = this.props;\n\n    const { animatedHeight, pan } = this.state;\n\n    if (visible) {\n      this.setState({ modalVisible: visible });\n\n      onOpen?.();\n\n      // Animated.timing(animatedHeight, {\n      //   useNativeDriver: false,\n      //   toValue: height,\n      //   duration: openDuration,\n      // }).start();\n      Animated.spring(animatedHeight, {\n        toValue: height,\n        useNativeDriver: false,\n      }).start();\n    } else {\n      Animated.timing(animatedHeight, {\n        useNativeDriver: false,\n        toValue: minClosingHeight,\n        duration: closeDuration,\n      }).start(() => {\n        pan.setValue({ x: 0, y: 0 });\n        this.setState({\n          modalVisible: visible,\n          animatedHeight: new Animated.Value(0),\n        });\n\n        onClose?.();\n      });\n    }\n  }\n\n  createPanResponder(props: RBSheetProps) {\n    const { closeOnDragDown = false, height, onClose } = props;\n    const { pan } = this.state;\n\n    this.panResponder = PanResponder.create({\n      onStartShouldSetPanResponder: () => closeOnDragDown,\n      onPanResponderMove: (e, gestureState) => {\n        if (gestureState.dy > 0) {\n          Animated.event([null, { dy: pan.y }], { useNativeDriver: false })(\n            e,\n            gestureState,\n          );\n        }\n      },\n      onPanResponderRelease: (_, gestureState) => {\n        if (height / 4 - gestureState.dy < 0) onClose?.();\n\n        Animated.spring(pan, {\n          toValue: { x: 0, y: 0 },\n          useNativeDriver: false,\n        }).start();\n      },\n    });\n  }\n\n  open() {\n    this.setModalVisible(true);\n  }\n\n  close() {\n    this.setModalVisible(false);\n  }\n\n  render() {\n    const {\n      animationType,\n      closeOnDragDown,\n      dragFromTopOnly,\n      closeOnPressMask,\n      closeOnPressBack,\n      children,\n      customStyles = {},\n      keyboardAvoidingViewEnabled,\n      onClose,\n    } = this.props;\n\n    const { animatedHeight, pan, modalVisible } = this.state;\n\n    const panStyle = {\n      transform: pan.getTranslateTransform(),\n    };\n\n    return (\n      <Modal\n        transparent\n        animationType={animationType}\n        visible={modalVisible}\n        supportedOrientations={SUPPORTED_ORIENTATIONS}\n        onRequestClose={() => {\n          if (closeOnPressBack) onClose?.();\n        }}\n      >\n        <KeyboardAvoidingView\n          enabled={keyboardAvoidingViewEnabled}\n          behavior=\"padding\"\n          style={[styles.wrapper, customStyles.wrapper]}\n        >\n          <TouchableOpacity\n            style={styles.mask}\n            activeOpacity={1}\n            onPress={() => (closeOnPressMask ? this.close() : null)}\n          />\n          <Animated.View\n            {...(!dragFromTopOnly && this.panResponder.panHandlers)}\n            style={[\n              panStyle,\n              styles.container,\n              { height: animatedHeight },\n              customStyles.container,\n            ]}\n          >\n            {closeOnDragDown && (\n              <View\n                {...(dragFromTopOnly && this.panResponder.panHandlers)}\n                style={styles.draggableContainer}\n              >\n                <View\n                  style={[styles.draggableIcon, customStyles.draggableIcon]}\n                />\n              </View>\n            )}\n            {children}\n          </Animated.View>\n        </KeyboardAvoidingView>\n      </Modal>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  wrapper: {\n    flex: 1,\n    backgroundColor: '#00000077',\n  },\n  mask: {\n    flex: 1,\n    backgroundColor: 'transparent',\n  },\n  container: {\n    backgroundColor: '#fff',\n    width: '100%',\n    height: 0,\n    overflow: 'hidden',\n  },\n  draggableContainer: {\n    width: '100%',\n    alignItems: 'center',\n    backgroundColor: 'transparent',\n  },\n  draggableIcon: {\n    width: 35,\n    height: 5,\n    borderRadius: 5,\n    margin: 10,\n    backgroundColor: '#ccc',\n  },\n});\n\nexport default RBSheet;\n"]}